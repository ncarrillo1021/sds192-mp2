---
title: "Mini-Project 2"
author: "Dianne Caravela, Neyda Carrillo, Carmen Canedo"
date: "2019-03-24"
output: 
  html_document:
    code_folding: hide
---

```{r, include = FALSE}
library(tidyverse)
library(devtools)
library(usmap)
library(gridExtra)
load("house_elections.rda")
load("candidates.rda")
load("committees.rda")
load("contributions.rda")
```


Generalizes the data wrangling so it works for any state
```{r, message=FALSE}
wrangle_state <- function(state_arg) {
  
#Creates list of democratic committees in given state
  party_cmte_DEM <- committees %>%
    filter(cmte_state == state_arg) %>% #filters for specific state
    filter(cmte_party_affiliation == "DEM") %>% #filter for democratic committees
    group_by(cmte_party_affiliation) %>%
    select(cmte_id)
  
#Creates list of republican committees in given state
  party_cmte_REP <- committees %>%
    filter(cmte_state == state_arg) %>%
    filter(cmte_party_affiliation == "REP") %>%
    group_by(cmte_party_affiliation) %>%
    select(cmte_id) 

#Creates table with just committee ID and transaction info for every transaction 
  trans_amt <- contributions %>%
    select(cmte_id, transaction_amt)

#Joins Rebublican committee list with transactions, summarizes the number of committies and the total amount of money they recieved  
  cmte_expenditure_DEM <- inner_join(party_cmte_DEM, trans_amt)  %>%
    summarize(num_committees = n(), total_cont = sum(transaction_amt))
  
#Does the same with Democratic committee list  
  cmte_expenditure_REP <- inner_join(party_cmte_REP, trans_amt)  %>%
    summarize(num_committees = n(), total_cont = sum(transaction_amt))

#Joins Republican and Democratic summary tables 
  final_table <- full_join(cmte_expenditure_DEM, cmte_expenditure_REP) %>%
    mutate(total_cont_thousands = total_cont / 1000)
  
print(final_table)
 
#Creates graph of total contributions by party 
  total_cont_graph <- ggplot(final_table, aes(x = cmte_party_affiliation, y = total_cont_thousands, fill = cmte_party_affiliation)) +
    geom_bar( stat = "identity", width = 0.5) +
    scale_fill_manual(breaks = c("DEM", "REP"),
                    values = c("blue", "red")) +
    guides(fill = FALSE) +
    xlab("Party Affiliation") + ylab("Total contributions (in thousands of dollars)") + ggtitle("Amount of contributions \nby committees by party in ", state_arg)

#Creates graph of number of committees by party
  num_commit_graph <- ggplot(final_table, aes(x = cmte_party_affiliation, y = num_committees, fill = cmte_party_affiliation)) +
    geom_bar( stat = "identity", width = 0.5) +
    scale_fill_manual(breaks = c("DEM", "REP"),
                    values = c("blue", "red")) +
    guides(fill = FALSE) +
    xlab("Party Affiliation") + ylab("Number of Committees") + ggtitle("Number of committees \nby party afffiliation in ", state_arg)
 
#prints the two graphs side by side 
  grid.arrange(num_commit_graph, total_cont_graph, nrow = 1)
}

states <- c("HI")
sapply(states, wrangle_state)
```
wrangle_state(state_arg = "CA")

ratio_table <- final_table %>%
  spread(key = cmte_party_affiliation, value = num_committees) %>%
  mutate(percent_rep_commit = )
ratio_table
mutate()

> Word count: 'r wordcountaddin::word_count()'

 List of all 50 states:
states <- c("AL", "AK", "AZ", "AR", "CA", "CO", "CT", "DE", "FL", "GA", "HI", "ID", "IL", "IN", "IA", "KS", "KY", "LA", "ME", "MD", "MA", "MI", "MN", "MS", "MO", "MT", "NE", "NV", "NH", "NJ", "NM", "NY", "NC", "ND", "OH", "OK", "OR", "PA", "RI", "SC", "SD", "TN", "TX", "UT", "VT", "VA", "WA", "WV", "WI", "WY")
